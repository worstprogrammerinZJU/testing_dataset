# .github/workflows/test-arm64-keep-name.yml
name: Test ARM64 Assembly (Keep Original Names)

on: [push, workflow_dispatch]

jobs:
  test-arm64-keep-name:
    runs-on: macos-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Install tools
      run: |
        brew install coreutils
    
    - name: Test and save with original names
      run: |
        echo "=== ARM64 æ±‡ç¼–æµ‹è¯•ï¼ˆä¿ç•™åŸæ–‡ä»¶åï¼‰==="
        
        # åˆ›å»ºæˆåŠŸæ–‡ä»¶ç›®å½•
        mkdir -p successful_files
        
        TOTAL=0
        SUCCESS=0
        
        for file in *.s; do
          if [ -f "$file" ]; then
            TOTAL=$((TOTAL + 1))
            NAME="${file%.s}"
            
            echo "æµ‹è¯•: $file"
            echo "----------------------------------------"
            
            # ç¼–è¯‘
            if clang "$file" -o "$NAME" 2>/dev/null; then
              echo "âœ… ç¼–è¯‘æˆåŠŸ"
              
              # æ‰§è¡Œæµ‹è¯•
              if echo -e "1\n2 3" | timeout 3 ./"$NAME" >/dev/null 2>&1; then
                SUCCESS=$((SUCCESS + 1))
                echo "âœ… æ‰§è¡ŒæˆåŠŸ"
                
                # ä¿å­˜æ–‡ä»¶ï¼ˆä¿ç•™åŸæ–‡ä»¶åï¼‰
                cp "$file" "successful_files/$file"
                echo "ğŸ“ å·²ä¿å­˜: $file"
              else
                echo "âŒ æ‰§è¡Œå¤±è´¥"
              fi
            else
              echo "âŒ ç¼–è¯‘å¤±è´¥"
            fi
            echo ""
          fi
        done
        
        echo "========================================"
        echo "æµ‹è¯•å®Œæˆ: $SUCCESS/$TOTAL ä¸ªæ–‡ä»¶æˆåŠŸ"
        echo "æˆåŠŸæ–‡ä»¶åˆ—è¡¨:"
        ls -la successful_files/ 2>/dev/null || echo "æ— æˆåŠŸæ–‡ä»¶"
    
    - name: Upload successful files
      uses: actions/upload-artifact@v4
      with:
        name: successful-arm64-files
        path: successful_files/
        retention-days: 30
